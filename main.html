<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ManivA — AriVa Code Assistant</title>
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=DM+Sans:ital,opsz,wght@0,9..40,400;0,9..40,600;0,9..40,700&family=DM+Mono&display=swap" rel="stylesheet" />
  <style>
    :root {
      --maniv-bg: #0f1114;
      --maniv-surface: #181b20;
      --maniv-card: #1e2228;
      --maniv-edge: #2c323a;
      --maniv-text: #e6e9ec;
      --maniv-dim: #8b929a;
      --maniv-accent: #6366f1;
      --maniv-success: #22c55e;
      --maniv-warn: #f59e0b;
      --maniv-error: #ef4444;
      --maniv-radius: 8px;
      --maniv-font: "DM Sans", sans-serif;
      --maniv-mono: "DM Mono", monospace;
    }
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body {
      font-family: var(--maniv-font);
      background: var(--maniv-bg);
      color: var(--maniv-text);
      min-height: 100vh;
      background-image: radial-gradient(ellipse 60% 40% at 50% 0%, rgba(99, 102, 241, 0.08), transparent);
    }
    .maniv-wrap {
      max-width: 820px;
      margin: 0 auto;
      padding: 1.5rem;
      min-height: 100vh;
    }
    header.maniv-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      flex-wrap: wrap;
      gap: 1rem;
      padding-bottom: 1rem;
      border-bottom: 1px solid var(--maniv-edge);
      margin-bottom: 1.25rem;
    }
    .maniv-logo {
      font-size: 1.6rem;
      font-weight: 700;
      color: var(--maniv-accent);
    }
    .maniv-tagline { font-size: 0.75rem; color: var(--maniv-dim); margin-top: 0.2rem; }
    .maniv-card {
      background: var(--maniv-card);
      border: 1px solid var(--maniv-edge);
      border-radius: var(--maniv-radius);
      padding: 1.25rem;
      margin-bottom: 1rem;
    }
    .maniv-card h2 {
      font-size: 1rem;
      font-weight: 700;
      color: var(--maniv-accent);
      margin-bottom: 0.75rem;
    }
    .maniv-input {
      width: 100%;
      font-family: var(--maniv-mono);
      font-size: 0.85rem;
      padding: 0.6rem 0.8rem;
      background: var(--maniv-surface);
      border: 1px solid var(--maniv-edge);
      border-radius: 6px;
      color: var(--maniv-text);
      margin-bottom: 0.5rem;
    }
    .maniv-input:focus {
      outline: none;
      border-color: var(--maniv-accent);
    }
    .maniv-btn {
      font-family: var(--maniv-font);
      font-size: 0.85rem;
      font-weight: 600;
      padding: 0.5rem 1rem;
      border: 1px solid var(--maniv-accent);
      border-radius: 6px;
      background: rgba(99, 102, 241, 0.15);
      color: var(--maniv-accent);
      cursor: pointer;
      transition: background 0.2s;
    }
    .maniv-btn:hover { background: rgba(99, 102, 241, 0.25); }
    .maniv-btn:disabled { opacity: 0.5; cursor: not-allowed; }
    .maniv-output {
      font-family: var(--maniv-mono);
      font-size: 0.8rem;
      background: var(--maniv-surface);
      border: 1px solid var(--maniv-edge);
      border-radius: 6px;
      padding: 0.75rem;
      white-space: pre-wrap;
      word-break: break-all;
      max-height: 320px;
      overflow-y: auto;
      margin-top: 0.5rem;
    }
    .maniv-output.success { border-color: var(--maniv-success); }
    .maniv-output.error { border-color: var(--maniv-error); }
    .maniv-label { font-size: 0.8rem; color: var(--maniv-dim); margin-bottom: 0.35rem; display: block; }
    .maniv-tabs {
      display: flex;
      gap: 0.5rem;
      margin-bottom: 1rem;
      border-bottom: 1px solid var(--maniv-edge);
      padding-bottom: 0.5rem;
    }
    .maniv-tab {
      font-size: 0.85rem;
      font-weight: 600;
      padding: 0.4rem 0.8rem;
      border: none;
      border-radius: 6px;
      background: transparent;
      color: var(--maniv-dim);
      cursor: pointer;
      transition: color 0.2s, background 0.2s;
    }
    .maniv-tab:hover { color: var(--maniv-text); }
    .maniv-tab.active { color: var(--maniv-accent); background: rgba(99, 102, 241, 0.1); }
    .maniv-panel { display: none; }
    .maniv-panel.active { display: block; }
    .maniv-list { list-style: none; font-size: 0.85rem; }
    .maniv-list li { padding: 0.35rem 0; border-bottom: 1px solid var(--maniv-edge); }
    .maniv-list li:last-child { border-bottom: none; }
    .maniv-addr { font-family: var(--maniv-mono); font-size: 0.75rem; color: var(--maniv-dim); word-break: break-all; }
    .maniv-footer { text-align: center; font-size: 0.75rem; color: var(--maniv-dim); margin-top: 2rem; padding-top: 1rem; border-top: 1px solid var(--maniv-edge); }
    .maniv-footer a { color: var(--maniv-accent); text-decoration: none; }
    .maniv-footer a:hover { text-decoration: underline; }
    textarea.maniv-input { min-height: 120px; resize: vertical; }
    .maniv-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; margin-bottom: 1rem; }
    @media (max-width: 640px) { .maniv-grid { grid-template-columns: 1fr; } }
    .maniv-code-inline { font-family: var(--maniv-mono); font-size: 0.8rem; background: var(--maniv-surface); padding: 0.15rem 0.4rem; border-radius: 4px; color: var(--maniv-accent); }
    .maniv-h3 { font-size: 0.95rem; font-weight: 600; color: var(--maniv-text); margin: 1rem 0 0.5rem; }
    .maniv-p { font-size: 0.85rem; color: var(--maniv-dim); line-height: 1.5; margin-bottom: 0.5rem; }
    .maniv-table { width: 100%; font-size: 0.8rem; border-collapse: collapse; }
    .maniv-table th, .maniv-table td { padding: 0.4rem 0.6rem; border-bottom: 1px solid var(--maniv-edge); text-align: left; }
    .maniv-table th { color: var(--maniv-dim); font-weight: 600; }
  </style>
</head>
<body>
  <div class="maniv-wrap">
    <header class="maniv-header">
      <div>
        <div class="maniv-logo">ManivA</div>
        <div class="maniv-tagline">AriVa code assistant · Sessions, completions, validation</div>
      </div>
    </header>

    <div class="maniv-tabs">
      <button type="button" class="maniv-tab active" data-panel="assist">Assist</button>
      <button type="button" class="maniv-tab" data-panel="validate">Validate</button>
      <button type="button" class="maniv-tab" data-panel="config">Config</button>
      <button type="button" class="maniv-tab" data-panel="api">API</button>
      <button type="button" class="maniv-tab" data-panel="rules">Rules</button>
      <button type="button" class="maniv-tab" data-panel="ref">Reference</button>
    </div>

    <div id="maniv-panel-assist" class="maniv-panel active">
      <div class="maniv-card">
        <h2>Session</h2>
        <label class="maniv-label">User ref</label>
        <input type="text" class="maniv-input" id="maniv-user-ref" value="maniv_user_1" placeholder="user ref" />
        <button type="button" class="maniv-btn" id="maniv-create-session">Create session</button>
        <div class="maniv-output" id="maniv-session-output"></div>
      </div>
      <div class="maniv-card">
        <h2>Completions</h2>
        <label class="maniv-label">Session ID (from above)</label>
        <input type="text" class="maniv-input" id="maniv-completion-session" placeholder="session_id" />
        <label class="maniv-label">Prefix / line context</label>
        <input type="text" class="maniv-input" id="maniv-prefix" value="im" placeholder="prefix" />
        <label class="maniv-label">Language</label>
        <input type="text" class="maniv-input" id="maniv-lang" value="py" placeholder="py" />
        <button type="button" class="maniv-btn" id="maniv-get-completions">Get completions</button>
        <div class="maniv-output" id="maniv-completions-output"></div>
      </div>
      <div class="maniv-card">
        <h2>Suggestions</h2>
        <label class="maniv-label">Session ID</label>
        <input type="text" class="maniv-input" id="maniv-suggest-session" placeholder="session_id" />
        <label class="maniv-label">Query</label>
        <input type="text" class="maniv-input" id="maniv-query" value="suggest a fix" placeholder="query" />
        <button type="button" class="maniv-btn" id="maniv-get-suggestions">Get suggestions</button>
        <div class="maniv-output" id="maniv-suggestions-output"></div>
      </div>
    </div>

    <div id="maniv-panel-validate" class="maniv-panel">
      <div class="maniv-card">
        <h2>Validate code</h2>
        <label class="maniv-label">Code</label>
        <textarea class="maniv-input" id="maniv-code" placeholder="Paste code to validate (trailing WS, line length, braces, tabs, indent)">def foo():
  x = 1  
</textarea>
        <button type="button" class="maniv-btn" id="maniv-validate">Validate</button>
        <div class="maniv-output" id="maniv-validate-output"></div>
      </div>
    </div>

    <div id="maniv-panel-config" class="maniv-panel">
      <div class="maniv-card">
        <h2>AriVa config</h2>
        <p style="font-size: 0.85rem; color: var(--maniv-dim); margin-bottom: 0.75rem;">Addresses and hex are unique to AriVa (not reused from other contracts).</p>
        <ul class="maniv-list">
          <li><span class="maniv-addr">Coordinator: 0x9f8E7d6C5b4A39281706f5e4d3c2B1a098765432</span></li>
          <li><span class="maniv-addr">Vault: 0x8e7D6c5B4a39281706F5e4d3C2b1A0987654321</span></li>
          <li><span class="maniv-addr">Relay: 0x7d6C5b4A39281706f5E4d3c2B1a09876543210</span></li>
          <li><span class="maniv-addr">Oracle: 0x6c5B4a39281706f5e4D3c2b1A09876543210fe</span></li>
          <li><span class="maniv-addr">Sentinel: 0x5b4A39281706f5e4d3C2b1a09876543210fedc</span></li>
          <li><span class="maniv-addr">ARIVA_DOMAIN_SALT: 0xe9f8a7b6c5d4e3f2a1b0c9d8e7f6a5b4c3d2e1f0</span></li>
          <li><span class="maniv-addr">ARIVA_SESSION_SALT: 0xd8e7f6a5b4c3d2e1f0a9b8c7d6e5f4a3b2c1d0e9</span></li>
          <li><span class="maniv-addr">ARIVA_COMPLETION_SEED: 0xc7d6e5f4a3b2c1d0e9f8a7b6c5d4e3f2a1b0c9d8</span></li>
        </ul>
        <p style="font-size: 0.8rem; color: var(--maniv-dim); margin-top: 0.75rem;">MAX_SUGGESTIONS_PER_REQUEST: 24 · MAX_COMPLETIONS_PER_LINE: 12 · MAX_SESSION_DURATION_SEC: 7200 · MAX_SESSIONS_PER_USER: 16 · CODE_CONTEXT_WINDOW: 2048</p>
        <div class="maniv-h3">Address uniqueness</div>
        <p class="maniv-p">The five addresses (Coordinator, Vault, Relay, Oracle, Sentinel) and three hex salts (ARIVA_DOMAIN_SALT, ARIVA_SESSION_SALT, ARIVA_COMPLETION_SEED) are defined only in AriVa (contracts/AriVa.py) and in this ManivA UI. They are not reused from Spella, FrostVow, Robotank, BacklineLedger, RigCue, HermesAI, EwAI, ThornGate, FlintLock, or any other contract or code generation. confirm_ariva_addresses_unique() and confirm_ariva_hex_unique() in AriVa.py verify uniqueness.</p>
        <div class="maniv-h3">Constants table</div>
        <table class="maniv-table">
          <tr><th>Constant</th><th>Value</th></tr>
          <tr><td>MIN_QUERY_LEN</td><td>1</td></tr>
          <tr><td>MAX_QUERY_LEN</td><td>8192</td></tr>
          <tr><td>SUGGESTION_CACHE_TTL</td><td>300</td></tr>
          <tr><td>VALIDATION_RULESET_VERSION</td><td>3</td></tr>
          <tr><td>ASSISTANT_RESPONSE_MAX_LEN</td><td>4096</td></tr>
        </table>
        <div class="maniv-h3">Copy-paste constants (for Ama or backend)</div>
        <pre class="maniv-output" style="max-height: 240px; font-size: 0.7rem;">ARIVA_COORDINATOR = "0x9f8E7d6C5b4A39281706f5e4d3c2B1a098765432"
ARIVA_VAULT = "0x8e7D6c5B4a39281706F5e4d3C2b1A0987654321"
ARIVA_RELAY = "0x7d6C5b4A39281706f5E4d3c2B1a09876543210"
ARIVA_ORACLE = "0x6c5B4a39281706f5e4D3c2b1A09876543210fe"
ARIVA_SENTINEL = "0x5b4A39281706f5e4d3C2b1a09876543210fedc"
ARIVA_DOMAIN_SALT = "0xe9f8a7b6c5d4e3f2a1b0c9d8e7f6a5b4c3d2e1f0"
ARIVA_SESSION_SALT = "0xd8e7f6a5b4c3d2e1f0a9b8c7d6e5f4a3b2c1d0e9"
ARIVA_COMPLETION_SEED = "0xc7d6e5f4a3b2c1d0e9f8a7b6c5d4e3f2a1b0c9d8"
MAX_SUGGESTIONS_PER_REQUEST = 24
MAX_COMPLETIONS_PER_LINE = 12
MAX_SESSION_DURATION_SEC = 7200
MAX_SESSIONS_PER_USER = 16
CODE_CONTEXT_WINDOW = 2048</pre>
      </div>
      <div class="maniv-card">
        <h2>How to use</h2>
        <p class="maniv-p">ManivA is the web UI for the AriVa code assistant engine. AriVa is implemented in <span class="maniv-code-inline">contracts/AriVa.py</span> as a single Python module. All configuration (coordinator, vault, relay, oracle, sentinel addresses and domain/session/completion salts) is pre-populated; no deployment config is required.</p>
        <p class="maniv-p">Create a session with <span class="maniv-code-inline">create_session(user_ref, caller)</span> where caller must be the coordinator address. Then use <span class="maniv-code-inline">get_completions</span> and <span class="maniv-code-inline">get_suggestions</span> with the session_id. Use <span class="maniv-code-inline">validate_code</span> to run validation rules (trailing whitespace, line length, balanced braces, no tabs, indent, non-empty file, max blank lines).</p>
        <p class="maniv-p">The Ama app (<a href="../Ama/" style="color: var(--maniv-accent);">Ama</a>) is the Python CLI/desktop companion. Addresses and hex in AriVa are unique and not reused from Spella, FrostVow, Robotank, BacklineLedger, or any other contract.</p>
        <div class="maniv-h3">Supported languages</div>
        <p class="maniv-p">py, js, ts, sol, rs, go, java, cpp. Use <span class="maniv-code-inline">language</span> in get_completions.</p>
        <div class="maniv-h3">Error response format</div>
        <p class="maniv-p">When an exception is raised, handle_ariva_request returns e.g. <span class="maniv-code-inline">{ "error": "AriVaSessionNotFound", "message": "Session id does not exist." }</span>. Possible error keys: AriVaNotCoordinator, AriVaSessionNotFound, AriVaSessionLimitReached, AriVaQueryTooShort, AriVaQueryTooLong, AriVaSuggestionLimitReached, AriVaZeroDisallowed, AriVaContextOverflow, Unknown method, Internal.</p>
      </div>
    </div>

    <div id="maniv-panel-api" class="maniv-panel">
      <div class="maniv-card">
        <h2>API methods (handle_ariva_request)</h2>
        <p style="font-size: 0.85rem; color: var(--maniv-dim); margin-bottom: 0.75rem;">Call handle_ariva_request(platform, method, params). Coordinator: 0x9f8E7d6C5b4A39281706f5e4d3c2B1a098765432</p>
        <ul class="maniv-list">
          <li>config — no params</li>
          <li>create_session — user_ref, caller</li>
          <li>get_session — session_id</li>
          <li>close_session — session_id, caller</li>
          <li>update_context — session_id, context, caller</li>
          <li>validate_code — code</li>
          <li>get_completions — session_id, prefix, line_context, language, max_n</li>
          <li>get_suggestions — session_id, query, kind, max_n</li>
          <li>stats — no params</li>
          <li>cleanup_stale — no params</li>
        </ul>
      </div>
      <div class="maniv-card">
        <h2>Request templates</h2>
        <div class="maniv-output" style="max-height: 280px;" id="maniv-templates-output"></div>
      </div>
      <div class="maniv-card">
        <h2>Example integration (Python)</h2>
        <pre class="maniv-output" style="max-height: 360px; font-size: 0.75rem;">from contracts.AriVa import create_ariva, handle_ariva_request, ARIVA_COORDINATOR

platform = create_ariva()
coord = ARIVA_COORDINATOR

# Create session
r = handle_ariva_request(platform, "create_session", {"user_ref": "my_user", "caller": coord})
session_id = r["session_id"]

# Validate code
r = handle_ariva_request(platform, "validate_code", {"code": "def foo():\\n  pass  "})
print(r["results"])

# Get completions
r = handle_ariva_request(platform, "get_completions", {
    "session_id": session_id, "prefix": "im", "line_context": "import ",
    "language": "py", "max_n": 5
})
print(r["completions"])

# Get suggestions
r = handle_ariva_request(platform, "get_suggestions", {
    "session_id": session_id, "query": "fix typo", "kind": 1, "max_n": 10
})
print(r["suggestions"])

# Stats
r = handle_ariva_request(platform, "stats", {})
print(r)</pre>
      </div>
      <div class="maniv-card">
        <h2>Full demo script (run_ariva_demo)</h2>
        <pre class="maniv-output" style="max-height: 400px; font-size: 0.72rem;"># In Python:
# from contracts.AriVa import create_ariva, run_ariva_demo, health_check_ariva

# platform = create_ariva()
# result = run_ariva_demo(platform)
# print(result)  # session_id, validate, completions_count, suggestions_count

# health = health_check_ariva(platform)
# print(health)  # ok, addresses_unique, hex_unique, stats

# run_ariva_simulation(platform, num_sessions=8, queries_per_session=5)
# run_ariva_simulation_v2(platform, num_users=12, sessions_per_user=2, validate_samples=20)

# confirm_ariva_addresses_unique()  # True
# confirm_ariva_hex_unique()       # True
# get_all_ariva_constants()       # dict of all constants
# list_ariva_methods()             # list of method names for handle_ariva_request</pre>
      </div>
      <div class="maniv-card">
        <h2>Example responses</h2>
        <p class="maniv-p">create_session: { "session_id": "&lt;32-char hex&gt;", "user_ref": "user_1" }</p>
        <p class="maniv-p">validate_code: { "results": [ { "passed": false, "rule_id": "ARIVA_NO_TRAILING_WS", "message": "Trailing whitespace", "line": 2, "column": 7 } ], "passed": false }</p>
        <p class="maniv-p">get_completions: { "completions": [ { "text": "token_...", "kind": 0, "confidence": 0.75 } ] }</p>
        <p class="maniv-p">get_suggestions: { "suggestions": [ { "suggestion_id": "...", "kind": 1, "text": "suggestion_0", "confidence": 0.8 } ] }</p>
        <p class="maniv-p">stats: { "request_count": 0, "total_suggestions_served": 0, "active_sessions": 0 }</p>
        <p class="maniv-p">Errors: { "error": "AriVaSessionNotFound", "message": "..." } etc.</p>
      </div>
      <div class="maniv-card">
        <h2>AriVa module functions (AriVa.py)</h2>
        <p class="maniv-p">create_ariva, create_ariva_with_events, handle_ariva_request, list_ariva_methods, get_all_ariva_constants, health_check_ariva, readiness_ariva, run_ariva_demo, run_ariva_simulation, run_ariva_simulation_v2, batch_handle_ariva, confirm_ariva_addresses_unique, confirm_ariva_hex_unique, get_request_templates, get_display_constants, get_rule_ids, get_rule_id_list, get_validation_rule_descriptions, get_suggestion_kind_descriptions, get_session_status_descriptions, format_validation_results_for_display, format_validation_for_cli, format_config_for_display, get_coordinator_address, get_vault_address, get_relay_address, get_oracle_address, get_sentinel_address, get_domain_salt, get_session_salt, get_completion_seed, get_max_suggestions_per_request, get_max_completions_per_line, get_max_session_duration_sec, get_max_sessions_per_user, get_min_query_len, get_max_query_len, get_code_context_window, all_ariva_addresses, all_ariva_salts, confirm_all_addresses_valid, confirm_all_salts_valid, metadata_ariva, ariva_version_info, supported_languages_list, is_valid_language, default_max_completions, default_max_suggestions. Platform methods: api_create_session, api_get_session, api_close_session, api_update_context, api_validate_code, api_get_completions, api_get_suggestions, api_config, api_stats.</p>
      </div>
      <div class="maniv-card">
        <h2>Method param keys</h2>
        <table class="maniv-table">
          <tr><th>Method</th><th>Param keys</th></tr>
          <tr><td>create_session</td><td>user_ref, caller</td></tr>
          <tr><td>get_session</td><td>session_id</td></tr>
          <tr><td>close_session</td><td>session_id, caller</td></tr>
          <tr><td>update_context</td><td>session_id, context, caller</td></tr>
          <tr><td>validate_code</td><td>code</td></tr>
          <tr><td>get_completions</td><td>session_id, prefix, line_context, language, max_n</td></tr>
          <tr><td>get_suggestions</td><td>session_id, query, kind, max_n</td></tr>
          <tr><td>stats</td><td>(none)</td></tr>
          <tr><td>cleanup_stale</td><td>(none)</td></tr>
          <tr><td>config</td><td>(none)</td></tr>
        </table>
      </div>
    </div>

    <div id="maniv-panel-rules" class="maniv-panel">
      <div class="maniv-card">
        <h2>Validation rules (AriVa)</h2>
        <ul class="maniv-list">
          <li>ARIVA_NO_TRAILING_WS — Remove trailing whitespace from line</li>
          <li>ARIVA_MAX_LINE_LEN — Line exceeds 120 characters</li>
          <li>ARIVA_BALANCED_BRACES — Unbalanced or unclosed bracket</li>
          <li>ARIVA_NO_TABS — Use spaces instead of tabs</li>
          <li>ARIVA_INDENT — Indent must be multiple of 4 spaces</li>
          <li>ARIVA_NON_EMPTY — File must not be empty</li>
          <li>ARIVA_MAX_BLANK — Too many consecutive blank lines</li>
        </ul>
        <div class="maniv-h3">Rule details</div>
        <p class="maniv-p">ARIVA_NO_TRAILING_WS: checks each line for spaces/tabs after the last non-whitespace character. ARIVA_MAX_LINE_LEN: default 120 chars per line. ARIVA_BALANCED_BRACES: checks (), [], {} are balanced. ARIVA_NO_TABS: disallows tab characters. ARIVA_INDENT: expects indentation in multiples of 4 spaces. ARIVA_NON_EMPTY: file content must have at least one non-whitespace character. ARIVA_MAX_BLANK: at most 2 consecutive blank lines by default.</p>
      </div>
      <div class="maniv-card">
        <h2>Suggestion kinds</h2>
        <ul class="maniv-list">
          <li>0: Completion</li>
          <li>1: Fix</li>
          <li>2: Hint</li>
          <li>3: Refactor</li>
        </ul>
      </div>
      <div class="maniv-card">
        <h2>Session status</h2>
        <ul class="maniv-list">
          <li>0: Active</li>
          <li>1: Idle</li>
          <li>2: Closed</li>
        </ul>
      </div>
      <div class="maniv-card">
        <h2>Exceptions (AriVa)</h2>
        <ul class="maniv-list">
          <li>AriVaNotCoordinator</li>
          <li>AriVaSessionNotFound</li>
          <li>AriVaSessionLimitReached</li>
          <li>AriVaQueryTooShort / AriVaQueryTooLong</li>
          <li>AriVaSuggestionLimitReached</li>
          <li>AriVaZeroDisallowed</li>
          <li>AriVaValidationFailed</li>
          <li>AriVaContextOverflow</li>
        </ul>
      </div>
      <div class="maniv-card">
        <h2>Supported languages</h2>
        <p class="maniv-p">py, js, ts, sol, rs, go, java, cpp. Pass <span class="maniv-code-inline">language</span> in get_completions params. Use normalize_language(lang) in AriVa for default "py".</p>
      </div>
      <div class="maniv-card">
        <h2>Error response keys</h2>
        <p class="maniv-p">When handle_ariva_request catches an exception it returns JSON with key "error" and optionally "message". Possible error values: AriVaNotCoordinator, AriVaSessionNotFound, AriVaSessionLimitReached, AriVaQueryTooShort, AriVaQueryTooLong, AriVaSuggestionLimitReached, AriVaZeroDisallowed, AriVaContextOverflow, Unknown method, Internal.</p>
      </div>
      <div class="maniv-card">
        <h2>Example JSON request/response</h2>
        <pre class="maniv-output" style="max-height: 200px; font-size: 0.7rem;">Request: { "method": "create_session", "params": { "user_ref": "alice", "caller": "0x9f8E7d6C5b4A39281706f5e4d3c2B1a098765432" } }
Response: { "session_id": "a1b2c3d4e5f6789012345678abcdef01", "user_ref": "alice" }

Request: { "method": "validate_code", "params": { "code": "def x():\\n  pass  " } }
Response: { "results": [ { "passed": false, "rule_id": "ARIVA_NO_TRAILING_WS", "message": "Trailing whitespace", "line": 2, "column": 7 } ], "passed": false }</pre>
      </div>
      <div class="maniv-card">
        <h2>ManivA + Ama</h2>
        <p class="maniv-p">ManivA is the web UI for the AriVa code assistant. Ama is the Python app (CLI or desktop) that can call the same AriVa engine. Both use the same coordinator address and config. Addresses and hex are unique to AriVa and are not reused from any other contract (Spella, FrostVow, Robotank, BacklineLedger, RigCue, HermesAI, EwAI, ThornGate, FlintLock, etc.).</p>
      </div>
    </div>

    <div id="maniv-panel-ref" class="maniv-panel">
      <div class="maniv-card">
        <h2>Reference: AriVa constants</h2>
        <pre class="maniv-output" style="max-height: 320px; font-size: 0.72rem;">MAX_SUGGESTIONS_PER_REQUEST = 24
MAX_COMPLETIONS_PER_LINE = 12
MAX_SESSION_DURATION_SEC = 7200
MAX_SESSIONS_PER_USER = 16
MIN_QUERY_LEN = 1
MAX_QUERY_LEN = 8192
SUGGESTION_CACHE_TTL = 300
VALIDATION_RULESET_VERSION = 3
CODE_CONTEXT_WINDOW = 2048
ASSISTANT_RESPONSE_MAX_LEN = 4096

SuggestionKind: COMPLETION=0, FIX=1, HINT=2, REFACTOR=3
SessionStatus: ACTIVE=0, IDLE=1, CLOSED=2</pre>
      </div>
      <div class="maniv-card">
        <h2>Reference: All methods</h2>
        <ul class="maniv-list">
          <li>config</li>
          <li>create_session (user_ref, caller)</li>
          <li>get_session (session_id)</li>
          <li>close_session (session_id, caller)</li>
          <li>update_context (session_id, context, caller)</li>
          <li>validate_code (code)</li>
          <li>get_completions (session_id, prefix, line_context, language, max_n)</li>
          <li>get_suggestions (session_id, query, kind, max_n)</li>
          <li>stats</li>
          <li>cleanup_stale</li>
        </ul>
      </div>
      <div class="maniv-card">
        <h2>Reference: Confirm uniqueness</h2>
        <p class="maniv-p">In AriVa.py: confirm_ariva_addresses_unique() returns True if all five addresses are valid and distinct. confirm_ariva_hex_unique() returns True if all three salts are valid and distinct. These addresses and hex values are not reused from any previous contract or code generation.</p>
      </div>
    </div>

    <div class="maniv-card">
      <h2>Quick start</h2>
      <ol style="font-size: 0.85rem; color: var(--maniv-dim); line-height: 1.7; padding-left: 1.25rem; margin: 0;">
        <li>Import: from contracts.AriVa import create_ariva, handle_ariva_request, ARIVA_COORDINATOR</li>
        <li>Create platform: platform = create_ariva()</li>
        <li>Create session: r = handle_ariva_request(platform, "create_session", {"user_ref": "your_user", "caller": ARIVA_COORDINATOR})</li>
        <li>Store session_id from r["session_id"]</li>
        <li>Validate code: handle_ariva_request(platform, "validate_code", {"code": "your code string"})</li>
        <li>Get completions: handle_ariva_request(platform, "get_completions", {"session_id": sid, "prefix": "im", "line_context": "import ", "language": "py", "max_n": 5})</li>
        <li>Get suggestions: handle_ariva_request(platform, "get_suggestions", {"session_id": sid, "query": "fix", "kind": 1, "max_n": 10})</li>
        <li>Update context: handle_ariva_request(platform, "update_context", {"session_id": sid, "context": "def foo(): pass", "caller": ARIVA_COORDINATOR})</li>
        <li>Close session when done: handle_ariva_request(platform, "close_session", {"session_id": sid, "caller": ARIVA_COORDINATOR})</li>
        <li>Check stats: handle_ariva_request(platform, "stats", {})</li>
      </ol>
    </div>

    <p class="maniv-footer">
      AriVa engine: <code>contracts/AriVa.py</code> · App: <a href="../Ama/">Ama</a> · Addresses/hex unique
    </p>
  </div>

  <script>
    (function () {
      var COORDINATOR = "0x9f8E7d6C5b4A39281706f5e4d3c2B1a098765432";
      var sessionId = "";

      document.querySelectorAll(".maniv-tab").forEach(function (tab) {
        tab.addEventListener("click", function () {
          var panelId = "maniv-panel-" + tab.getAttribute("data-panel");
          document.querySelectorAll(".maniv-tab").forEach(function (t) { t.classList.remove("active"); });
          document.querySelectorAll(".maniv-panel").forEach(function (p) { p.classList.remove("active"); });
          tab.classList.add("active");
          var panel = document.getElementById(panelId);
          if (panel) panel.classList.add("active");
        });
      });

      function out(elId, text, isError) {
        var el = document.getElementById(elId);
        if (!el) return;
        el.textContent = text;
        el.className = "maniv-output" + (isError ? " error" : " success");
      }

      document.getElementById("maniv-create-session").addEventListener("click", function () {
        var userRef = document.getElementById("maniv-user-ref").value.trim() || "maniv_user_1";
        var payload = { method: "create_session", params: { user_ref: userRef, caller: COORDINATOR } };
        out("maniv-session-output", "Request: " + JSON.stringify(payload, null, 2) + "\n\nResponse: (use Ama app or backend; session_id stored on create)");
        sessionId = "demo_" + Math.random().toString(36).slice(2, 12);
        document.getElementById("maniv-completion-session").value = sessionId;
        document.getElementById("maniv-suggest-session").value = sessionId;
        out("maniv-session-output", "Demo mode: session_id = " + sessionId + "\n\nIn production, call AriVa handle_ariva_request(platform, 'create_session', { user_ref: '" + userRef + "', caller: '" + COORDINATOR + "' })");
      });

      document.getElementById("maniv-get-completions").addEventListener("click", function () {
        var sid = document.getElementById("maniv-completion-session").value.trim();
        var prefix = document.getElementById("maniv-prefix").value;
        var lang = document.getElementById("maniv-lang").value.trim() || "py";
        out("maniv-completions-output", "get_completions(session_id='" + sid + "', prefix='" + prefix + "', language='" + lang + "')\n\nCall AriVa api_get_completions(platform, session_id, prefix, line_context, language) for results.");
      });

      document.getElementById("maniv-get-suggestions").addEventListener("click", function () {
        var sid = document.getElementById("maniv-suggest-session").value.trim();
        var query = document.getElementById("maniv-query").value;
        out("maniv-suggestions-output", "get_suggestions(session_id='" + sid + "', query='" + query + "')\n\nCall AriVa api_get_suggestions(platform, session_id, query, kind, max_n) for results.");
      });

      document.getElementById("maniv-validate").addEventListener("click", function () {
        var code = document.getElementById("maniv-code").value;
        out("maniv-validate-output", "validate_code(code=\n" + JSON.stringify(code) + ")\n\nAriVa rules: ARIVA_NO_TRAILING_WS, ARIVA_MAX_LINE_LEN, ARIVA_BALANCED_BRACES, ARIVA_NO_TABS, ARIVA_INDENT, ARIVA_NON_EMPTY, ARIVA_MAX_BLANK.\nCall api_validate_code(platform, code) for results.");
      });

      var REQUEST_TEMPLATES = {
        create_session: { user_ref: "user_1", caller: COORDINATOR },
        get_session: { session_id: "<session_id>" },
        close_session: { session_id: "<session_id>", caller: COORDINATOR },
        update_context: { session_id: "<session_id>", context: "def foo(): pass", caller: COORDINATOR },
        validate_code: { code: "def bar():\n  pass" },
        get_completions: { session_id: "<session_id>", prefix: "im", line_context: "import ", language: "py", max_n: 5 },
        get_suggestions: { session_id: "<session_id>", query: "suggest fix", kind: 1, max_n: 10 },
        stats: {},
        cleanup_stale: {},
        config: {},
      };

      function renderTemplates() {
        var el = document.getElementById("maniv-templates-output");
        if (!el) return;
        el.textContent = JSON.stringify(REQUEST_TEMPLATES, null, 2);
      }
      document.querySelectorAll(".maniv-tab").forEach(function (t) {
        t.addEventListener("click", function () {
          if (t.getAttribute("data-panel") === "api") renderTemplates();
        });
      });
      renderTemplates();

      var SUPPORTED_LANGUAGES = ["py", "js", "ts", "sol", "rs", "go", "java", "cpp"];
      var SUGGESTION_KINDS = [{ id: 0, name: "Completion" }, { id: 1, name: "Fix" }, { id: 2, name: "Hint" }, { id: 3, name: "Refactor" }];
      var SESSION_STATUSES = [{ id: 0, name: "Active" }, { id: 1, name: "Idle" }, { id: 2, name: "Closed" }];

      function formatAddressShort(addr, head, tail) {
        head = head || 6; tail = tail || 4;
        if (!addr || addr.length < head + tail) return addr || "";
        return addr.slice(0, head) + "..." + addr.slice(-tail);
      }
      function getCoordinatorShort() { return formatAddressShort(COORDINATOR); }
      function buildCreateSessionPayload(userRef) {
        return { method: "create_session", params: { user_ref: userRef || "user_1", caller: COORDINATOR } };
      }
      function buildValidatePayload(code) {
        return { method: "validate_code", params: { code: code || "" } };
      }
      function buildGetCompletionsPayload(sessionId, prefix, language, maxN) {
        return { method: "get_completions", params: { session_id: sessionId, prefix: prefix || "", line_context: prefix || "", language: language || "py", max_n: maxN || 12 } };
      }
      function buildGetSuggestionsPayload(sessionId, query, kind, maxN) {
        return { method: "get_suggestions", params: { session_id: sessionId, query: query || "", kind: kind || 0, max_n: maxN || 24 } };
      }
      function buildUpdateContextPayload(sessionId, context) {
        return { method: "update_context", params: { session_id: sessionId, context: context || "", caller: COORDINATOR } };
      }
      function buildCloseSessionPayload(sessionId) {
        return { method: "close_session", params: { session_id: sessionId, caller: COORDINATOR } };
      }
      function buildStatsPayload() { return { method: "stats", params: {} }; }
      function buildConfigPayload() { return { method: "config", params: {} }; }
      function buildCleanupPayload() { return { method: "cleanup_stale", params: {} }; }

      var DEMO_RESPONSE_CREATE_SESSION = { session_id: "a1b2c3d4e5f67890", user_ref: "maniv_user_1" };
      var DEMO_RESPONSE_VALIDATE = { results: [{ passed: false, rule_id: "ARIVA_NO_TRAILING_WS", message: "Trailing whitespace", line: 2, column: 7 }], passed: false };
      var DEMO_RESPONSE_COMPLETIONS = { completions: [{ text: "token_py_abc123", kind: 0, confidence: 0.75 }, { text: "token_py_def456", kind: 0, confidence: 0.7 }] };
      var DEMO_RESPONSE_SUGGESTIONS = { suggestions: [{ suggestion_id: "s1", kind: 1, text: "suggestion_0", confidence: 0.8 }, { suggestion_id: "s2", kind: 1, text: "suggestion_1", confidence: 0.7 }] };
      var DEMO_RESPONSE_STATS = { request_count: 42, total_suggestions_served: 120, active_sessions: 3 };
      var DEMO_RESPONSE_CONFIG = { coordinator: COORDINATOR, vault: "0x8e7D6c5B4a39281706F5e4d3C2b1A0987654321", relay: "0x7d6C5b4A39281706f5E4d3c2B1a09876543210", oracle: "0x6c5B4a39281706f5e4D3c2b1A09876543210fe", sentinel: "0x5b4A39281706f5e4d3C2b1a09876543210fedc", domain_salt: "0xe9f8a7b6c5d4e3f2a1b0c9d8e7f6a5b4c3d2e1f0", session_salt: "0xd8e7f6a5b4c3d2e1f0a9b8c7d6e5f4a3b2c1d0e9", completion_seed: "0xc7d6e5f4a3b2c1d0e9f8a7b6c5d4e3f2a1b0c9d8" };

      var VALIDATION_RULE_DESCRIPTIONS = {
        ARIVA_NO_TRAILING_WS: "Remove trailing whitespace from line",
        ARIVA_MAX_LINE_LEN: "Line exceeds maximum allowed length (120)",
        ARIVA_BALANCED_BRACES: "Unbalanced or unclosed bracket",
        ARIVA_NO_TABS: "Use spaces instead of tabs",
        ARIVA_INDENT: "Indent must be multiple of 4 spaces",
        ARIVA_NON_EMPTY: "File must not be empty",
        ARIVA_MAX_BLANK: "Too many consecutive blank lines"
      };
      function getRuleDescription(ruleId) { return VALIDATION_RULE_DESCRIPTIONS[ruleId] || "Unknown rule"; }
      function getAllRuleIds() { return Object.keys(VALIDATION_RULE_DESCRIPTIONS); }

      var EXAMPLE_VALIDATION_RESULTS = [
        { passed: false, rule_id: "ARIVA_NO_TRAILING_WS", message: "Trailing whitespace", line: 2, column: 7 },
        { passed: false, rule_id: "ARIVA_MAX_LINE_LEN", message: "Line exceeds 120 characters", line: 5, column: 121 },
        { passed: false, rule_id: "ARIVA_BALANCED_BRACES", message: "Unclosed bracket", line: 10, column: 1 },
        { passed: false, rule_id: "ARIVA_NO_TABS", message: "Use spaces instead of tabs", line: 3, column: 1 },
        { passed: false, rule_id: "ARIVA_INDENT", message: "Indent must be multiple of 4", line: 4, column: 1 },
        { passed: false, rule_id: "ARIVA_NON_EMPTY", message: "File must not be empty", line: 1, column: 1 },
        { passed: false, rule_id: "ARIVA_MAX_BLANK", message: "More than 2 consecutive blank lines", line: 8, column: 1 },
      ];
      function formatValidationForDisplay(results) {
        return results.map(function (r) {
          return r.rule_id + ": " + r.message + " (line " + r.line + ", col " + r.column + ")";
        }).join("\n");
      }
      function buildMockCreateSessionResponse(sessionId, userRef) {
        return { session_id: sessionId || "demo_sess_001", user_ref: userRef || "user_1" };
      }
      function buildMockValidateResponse(results) {
        return { results: results || [], passed: !(results && results.length); };
      }
      function buildMockCompletionsResponse(completions) {
        return { completions: completions || [] };
      }
      function buildMockSuggestionsResponse(suggestions) {
        return { suggestions: suggestions || [] };
      }
      function buildMockStatsResponse(requestCount, totalSuggestions, activeSessions) {
        return { request_count: requestCount || 0, total_suggestions_served: totalSuggestions || 0, active_sessions: activeSessions || 0 };
      }
      function buildMockErrorResponse(errorKey, message) {
        return { error: errorKey || "Internal", message: message || "" };
      }
      var METHOD_DESCRIPTIONS = {
        config: "Return coordinator, vault, relay, oracle, sentinel, domain_salt, session_salt, completion_seed",
        create_session: "Create a new assistant session for user_ref; caller must be coordinator",
        get_session: "Get session by session_id",
        close_session: "Close session; caller must be coordinator",
        update_context: "Update session context buffer; caller must be coordinator",
        validate_code: "Run validation rules on code string",
        get_completions: "Get completion suggestions for prefix/line_context in language",
        get_suggestions: "Get suggestions for query with kind (0=Completion, 1=Fix, 2=Hint, 3=Refactor)",
        stats: "Return request_count, total_suggestions_served, active_sessions",
        cleanup_stale: "Remove sessions inactive longer than MAX_SESSION_DURATION_SEC",
      };
      function getMethodDescription(method) { return METHOD_DESCRIPTIONS[method] || ""; }
      var SUGGESTION_KINDS = { 0: "Completion", 1: "Fix", 2: "Hint", 3: "Refactor" };
      function getSuggestionKindName(k) { return SUGGESTION_KINDS[k] != null ? SUGGESTION_KINDS[k] : "Unknown"; }
      function buildCompletionsPayload(sessionId, prefix, lang, maxN) {
        return { method: "get_completions", params: { session_id: sessionId, prefix: prefix || "", line_context: prefix || "", language: lang || "py", max_n: maxN || 12 } };
      }
      function buildSuggestionsPayload(sessionId, query, kind, maxN) {
        return { method: "get_suggestions", params: { session_id: sessionId, query: query || "", kind: kind != null ? kind : 0, max_n: maxN || 24 } };
      }
      function formatSessionStatus(active) { return active ? "active" : "closed"; }
      function formatValidationSummary(valid, errorCount) {
        if (valid) return "Valid (no errors)";
        return "Invalid (" + (errorCount || 0) + " error(s))";
      }
      function copyToClipboardFallback(text) { var ta = document.createElement("textarea"); ta.value = text; document.body.appendChild(ta); ta.select(); document.execCommand("copy"); document.body.removeChild(ta); }
      var MANIVA_UI_VERSION = "1.0";
      function isManivAReady() { return typeof buildCompletionsPayload === "function"; }
    })();
  </script>
</body>
</html>
